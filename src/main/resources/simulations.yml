incarnation: protelis

variables:
  Seed: &Seed
    type: LinearVariable
    #default, min, max, step
    parameters: [1, 1, 100, 1]
  Algorithm: &Algorithm
    type: ListOf
    parameters: ["nocomm", "ff_nocomm", "bc_re", "sm_av", "zz_linpro", "ff_linpro", "zz_linproF", "ff_linproF"]
  MaxCamerasPerTarget: &MaxCamerasPerTarget
    formula: 3
  CameraSpeed: &CameraSpeed
    type: ArbitraryVariable
    parameters: [3]
  ObjectSpeed: &ObjectSpeed
    type: ArbitraryVariable
    parameters: [1.4]
  ObjectsCamerasRatio: &ObjectsCamerasRatio
    type: ArbitraryVariable
    parameters: [2, 1.5, 1, 0.5, 0.1]
  NumObjects: &NumObjects
    formula: 100
  NumCameras: &NumCameras
    formula: NumObjects * ObjectsCamerasRatio
  EnvironmentSize: &EnvironmentSize
    type: ArbitraryVariable
    parameters: [500]
  ConnectionRange: &ConnectionRange
    type: ArbitraryVariable
    parameters: [800, 800, 200, 100, 50, 30, 20, 10, 5]
  FoVAngle: &FoVAngle
    type: ArbitraryVariable
    parameters: [60]
  FoVDistance: &FoVDistance
    type: ArbitraryVariable
    parameters: [30]
  RotationSpeed: &RotationSpeed
    type: ArbitraryVariable
    parameters: [36]
  WantedProbability: &WantedProbability
    type: ArbitraryVariable
    parameters: [0.05]
  WantedTimeDistribution: &WantedTimeDistribution # how many times per second the dice is rolled
    type: ArbitraryVariable
    parameters: [0.05]
  HalfEnvironmentSize: &HalfEnvironmentSize # needed for calculations
    formula: EnvironmentSize / 2
  NegHalfEnvironmentSize: &NegHalfEnvironmentSize # needed for calculations
    formula: -HalfEnvironmentSize

environment:
  type: Rectangular2DEnvironment
  parameters: [*EnvironmentSize, *EnvironmentSize]

network-model:
  type: ConnectWithinDistance
  parameters: [*ConnectionRange]

seeds:
  scenario: *Seed
  simulation: *Seed

export:
  - time
  - type: CamerasKCoverage
    parameters: [vision, wanted, *MaxCamerasPerTarget]
  - type: DistanceTraveled
    parameters: ["CamDist", vision]
  - type: DistanceTraveled
    parameters: ["ObjDist", wanted]

programs:
  - &Object
    - time-distribution: 1
      type: ChemicalReaction
      actions:
        - type: LevyWalk
          parameters: [*ObjectSpeed]
    - time-distribution: *WantedTimeDistribution
      type: ChemicalReaction
      actions:
        - type: RandomlyToggleMolecule
          parameters: [wanted, true, *WantedProbability]
  - &Camera
    - time-distribution: 2
      type: ChemicalReaction
      actions:
        - type: InitHeading
          parameters: []
        - type: See
          parameters: [*FoVDistance, *FoVAngle, vision]
        - type: HeadTowardTarget
          parameters: [heading, *RotationSpeed]
        - type: MoveToTarget
          parameters: [destination, *CameraSpeed]
    - time-distribution: 2
      type: ChemicalReaction
      conditions:
        - type: MoleculeHasConcentration
          parameters: [doZigZag, true]
      actions:
        - type: ZigZagMove
          parameters: [999999, *CameraSpeed]
    - time-distribution: 2
      type: ChemicalReaction
      conditions:
        - type: MoleculeHasConcentration
          parameters: [doSpin, true]
      actions:
        - type: Spin
          parameters: [*RotationSpeed]
    - time-distribution: 1
      program: *Algorithm
    - program: send



displacements:
  - in:
      type: Rectangle
      parameters: [*NumObjects, *NegHalfEnvironmentSize, *NegHalfEnvironmentSize, *EnvironmentSize, *EnvironmentSize]
    nodes:
      type: CircleNode
      parameters: [0.5]
    contents:
      - molecule: wanted
        concentration: false
    programs:
      - *Object
  - in:
      type: Rectangle
      parameters: [*NumCameras, *NegHalfEnvironmentSize, *NegHalfEnvironmentSize, *EnvironmentSize, *EnvironmentSize]
      #type: Circle
      #parameters: [*NumCameras, 0, 0, *HalfEnvironmentSize]
    nodes:
      type: ProtelisNode
    contents:
      - molecule: Target
        concentration: "\"wanted\""
      - molecule: MaxCamerasPerTarget
        concentration: *MaxCamerasPerTarget
      - molecule: FoVDistance
        concentration: *FoVDistance
      - molecule: EnvironmentSize
        concentration: *EnvironmentSize
      - molecule: MaxMovementSpeed
        concentration: *CameraSpeed
      - molecule: MaxRotationSpeed
        concentration: *RotationSpeed
      - molecule: noAttractiveForces
        concentration: true
    programs:
      - *Camera


